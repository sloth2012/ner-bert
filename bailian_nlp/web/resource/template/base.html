<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>news manager</title>

    <link href="{{ static_url('css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ static_url('css/bootstrap-toggle.min.css') }}" rel="stylesheet">
    <link href="{{ static_url('css/jquery.loading.min.css') }}" rel="stylesheet">
    <link href="{{ static_url('css/ui.css') }}" rel="stylesheet">
    {% block css %}{% end %}

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Bailian News</a>
        </div>
        <div class="collapse navbar-collapse" id="navbar">
            <ul class="nav navbar-nav">
                <li><a href="/info">info</a></li>
                <li><a href="/stats">stats</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false">status <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="/switches">switches</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="/tasks">tasks</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="/splashes?region=cn">splashes (cn)</a></li>
                        <li><a href="/splashes/details?region=cn">splashes details (cn)</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="/splashes?region=us">splashes (us)</a></li>
                        <li><a href="/splashes/details?region=us">splashes details (us)</a></li>
                    </ul>
                </li>
            </ul>
            <form action="/news/generated/search" class="navbar-form navbar-right" method="get">
                <div class="form-group">
                    <input type="text" placeholder="name org" name="query" class="form-control" style="width: 300px;">
                </div>
                <button type="submit" class="btn btn-primary">Search Generated News</button>
            </form>
        </div>
    </div>
</nav>

<div class="container">
    <div class="page-header">
        <h2>{% block title %}{% end %}
            <small>{% block subTitle %}{% end %}</small>
        </h2>
    </div>
    <div class="row">
        <!-- system modal start -->
        <div id="bailian-alert" class="modal col-md-12">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span
                                class="sr-only">Close</span></button>
                        <h5 class="modal-title"><i class="fa fa-exclamation-circle"></i> [Title]</h5>
                    </div>
                    <div class="modal-body small">
                        <p>[Message]</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary ok" data-dismiss="modal">[BtnOk]</button>
                        <button type="button" class="btn btn-default cancel" data-dismiss="modal">[BtnCancel]</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- system modal end -->
        <div class="col-md-12">
            {% block content %}{% end %}
        </div>
    </div>

    <hr>
    <footer>
        <p>Code url: <a target="_blank" href="https://gitlab.bailian-ai.com/lx/restfulAPI/tree/dev">restfulAPI</a></p>
        <p>Version: dev</p>
    </footer>
</div>

<script src="{{ static_url('js/jquery-1.11.3.min.js') }}"></script>
<script src="{{ static_url('js/bootstrap.min.js') }}"></script>
<script src="{{ static_url('js/URI.js') }}"></script>
<script src="{{ static_url('js/notify.min.js') }}"></script>
<script src="{{ static_url('js/ui.js') }}"></script>
<script src="{{ static_url('js/jquery.mark.min.js') }}"></script>
<script src="{{ static_url('js/bootstrap-toggle.min.js') }}"></script>
<script src="{{ static_url('js/socket.io.min.js') }}"></script>
<script src="{{ static_url('js/jquery.loading.min.js') }}"></script>
{% block js %}{% end %}

<script>

    $(function () {
        window.Modal = (function () {
            var reg = new RegExp("\\[([^\\[\\]]*?)\\]", 'igm');
            var alr = $("#bailian-alert");
            var ahtml = alr.html();

            //关闭时恢复 modal html 原样，供下次调用时 replace 用
            //var _init = function () {
            //    alr.on("hidden.bs.modal", function (e) {
            //        $(this).html(ahtml);
            //    });
            //}();

            /* html 复原不在 _init() 里面做了，重复调用时会有问题，直接在 _alert/_confirm 里面做 */


            var _alert = function (options) {
                alr.html(ahtml);    // 复原
                alr.find('.ok').removeClass('btn-success').addClass('btn-primary');
                alr.find('.cancel').hide();
                _dialog(options);

                return {
                    on: function (callback) {
                        if (callback && callback instanceof Function) {
                            alr.find('.ok').click(function () {
                                callback(true)
                            });
                        }
                    }
                };
            };

            var _confirm = function (options) {
                alr.html(ahtml); // 复原
                alr.find('.ok').removeClass('btn-primary').addClass('btn-success');
                alr.find('.cancel').show();
                _dialog(options);

                return {
                    on: function (callback) {
                        if (callback && callback instanceof Function) {
                            alr.find('.ok').click(function () {
                                callback(true)
                            });
                            alr.find('.cancel').click(function () {
                                callback(false)
                            });
                        }
                    }
                };
            };

            var _dialog = function (options) {
                var ops = {
                    msg: "提示内容",
                    title: "操作提示",
                    btnok: "确定",
                    btncl: "取消"
                };

                $.extend(ops, options);

                console.log(ops);

                var html = alr.html().replace(reg, function (node, key) {
                    return {
                        Title: ops.title,
                        Message: ops.msg,
                        BtnOk: ops.btnok,
                        BtnCancel: ops.btncl
                    }[key];
                });

                alr.html(html);
                alr.modal({
                    width: 500,
                    backdrop: 'static'
                });
            }

            return {
                alert: _alert,
                confirm: _confirm
            }

        })();
    });
</script>
</body>
</html>
